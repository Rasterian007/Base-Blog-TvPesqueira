<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TvPesqueira - Notícias de Pesqueira e Região</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
        /* --- ESTILOS GERAIS (Copiados de categoria.html) --- */
        :root {
            --cor-primaria: #FFD700;
            --cor-secundaria: #051e3e;
            --cor-terciaria: #ffffff;
            --cinza-fundo: #f4f5f7;
            --texto-escuro: #1a1a1a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', sans-serif; background-color: var(--cinza-fundo); color: var(--texto-escuro); line-height: 1.6; }
        a { text-decoration: none; color: inherit; transition: 0.3s; }
        ul { list-style: none; }
        img { width: 100%; height: auto; display: block; }
        
        /* HEADER */
        header { background-color: var(--cor-secundaria); color: var(--cor-terciaria); position: sticky; top: 0; z-index: 1000; border-bottom: 4px solid var(--cor-primaria); }
        .header-main { 
            max-width: 1200px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 20px; 
            flex-wrap: wrap;
        }
        .logo { font-family: 'Montserrat', sans-serif; font-size: 2rem; font-weight: 800; text-transform: uppercase; letter-spacing: -1px; display: flex; align-items: center; gap: 5px; }
        .logo span.tv { background: var(--cor-primaria); color: var(--cor-secundaria); padding: 0 10px; border-radius: 4px; }
        .nav-menu { display: flex; gap: 20px; }
        .nav-menu a { font-weight: 600; font-size: 0.9rem; text-transform: uppercase; padding: 5px 0; border-bottom: 2px solid transparent; }
        .nav-menu a:hover { color: var(--cor-primaria); border-bottom: 2px solid var(--cor-primaria); }
        .btn-live { background: #cc0000; color: white; padding: 5px 15px; border-radius: 50px; font-weight: bold; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; }

        /* Estilo para o botão de menu no mobile */
        .menu-toggle { display: none; cursor: pointer; color: var(--cor-terciaria); font-size: 1.5rem; }

        /* LAYOUT DA PÁGINA INICIAL */
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            padding: 0 20px; 
        }

        /* TÍTULOS DE SEÇÃO */
        .section-title { 
            font-family: 'Montserrat', sans-serif; 
            font-size: 1.5rem; 
            color: var(--cor-secundaria); 
            margin-bottom: 20px; 
            border-bottom: 4px solid var(--cor-primaria); 
            padding-bottom: 5px; 
            text-transform: uppercase;
        }

        /* --- DESTAQUES (NOVO) --- */
        .featured-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Principal à esquerda, Sub-destaques à direita */
            gap: 20px;
            margin-bottom: 40px;
        }

        /* Card Destaque Principal */
        .main-feature {
            background: var(--cor-terciaria);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        .main-feature-img { height: 400px; overflow: hidden; }
        .main-feature-img img { width: 100%; height: 100%; object-fit: cover; }
        .main-feature-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(5, 30, 62, 0.85); /* cor-secundaria com transparência */
            color: var(--cor-terciaria);
            padding: 20px;
        }
        .main-feature-category { font-size: 0.8rem; font-weight: 700; color: var(--cor-primaria); text-transform: uppercase; margin-bottom: 5px; }
        .main-feature-title { font-family: 'Montserrat', sans-serif; font-size: 2rem; margin-bottom: 10px; line-height: 1.2; }
        .main-feature-excerpt { font-size: 1rem; opacity: 0.9; margin-bottom: 15px; }
        .main-feature-meta { font-size: 0.8rem; opacity: 0.7; }
        .main-feature:hover .main-feature-title { color: var(--cor-primaria); }

        /* Sub-destaques (Sidebar) */
        .sub-features {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .sub-feature-card {
            background: var(--cor-terciaria);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .sub-feature-card-img { height: 120px; overflow: hidden; }
        .sub-feature-card-img img { width: 100%; height: 100%; object-fit: cover; }
        .sub-feature-card-content { padding: 15px; flex-grow: 1; }
        .sub-feature-card-category { font-size: 0.7rem; font-weight: 700; color: #777; text-transform: uppercase; margin-bottom: 5px; }
        .sub-feature-card-title { font-family: 'Montserrat', sans-serif; font-size: 1rem; margin-bottom: 5px; color: var(--texto-escuro); }
        .sub-feature-card-meta { font-size: 0.7rem; color: #999; margin-top: 5px; }
        .sub-feature-card:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }

        /* --- NOTÍCIAS RECENTES (REUSO DO CARD) --- */
        .recent-news-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 colunas na Home */
            gap: 20px;
        }
        
        /* CARD DE NOTÍCIA (Reutilizado de categoria.html) */
        .post-card { 
            background: var(--cor-terciaria); 
            border-radius: 8px; 
            overflow: hidden; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            transition: transform 0.2s; 
            height: 100%; /* Garantir que todos tenham a mesma altura */
            display: flex;
            flex-direction: column;
        }
        .post-card:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .post-card-img { height: 180px; overflow: hidden; flex-shrink: 0;}
        .post-card-img img { width: 100%; height: 100%; object-fit: cover; }
        .post-card-content { padding: 15px; flex-grow: 1;}
        .post-card-category { font-size: 0.75rem; font-weight: 700; color: #777; text-transform: uppercase; margin-bottom: 5px; }
        .post-card-title { font-family: 'Montserrat', sans-serif; font-size: 1.1rem; margin-bottom: 10px; color: var(--texto-escuro); }
        .post-card-excerpt { font-size: 0.9rem; color: #555; height: 40px; overflow: hidden; }
        .post-card-meta { font-size: 0.75rem; color: #999; margin-top: 10px; }


        /* FOOTER (Copiado de categoria.html) */
        footer { background-color: var(--cor-secundaria); color: var(--cor-terciaria); padding: 30px 0; border-top: 4px solid var(--cor-primaria); }
        .footer-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; }
        .footer-col h4 { font-family: 'Montserrat', sans-serif; font-size: 1.2rem; margin-bottom: 15px; color: var(--cor-primaria); }
        .footer-col a { display: block; margin-bottom: 8px; font-size: 0.9rem; opacity: 0.8; }
        .footer-col a:hover { opacity: 1; color: var(--cor-terciaria); }

        /* RESPONSIVIDADE (Copiado e Adaptado) */
        @media (max-width: 992px) {
            .header-main { flex-wrap: wrap; }
            .nav-menu { display: none; flex-direction: column; width: 100%; order: 4; }
            .nav-menu.active { display: flex; }
            .menu-toggle { display: block; order: 3; }

            .featured-grid {
                grid-template-columns: 1fr; /* Coluna única no tablet/mobile */
            }
            .recent-news-grid { 
                grid-template-columns: repeat(2, 1fr); /* 2 colunas no tablet */
            }
            .main-feature-img { height: 300px; }
            .main-feature-title { font-size: 1.8rem; }
            .sub-features {
                display: grid;
                grid-template-columns: 1fr 1fr; /* 2 sub-destaques lado a lado */
            }
        }
        @media (max-width: 600px) {
            .recent-news-grid { grid-template-columns: 1fr; } /* Apenas 1 coluna de notícias */
            .main-feature-img { height: 200px; }
            .main-feature-title { font-size: 1.4rem; }
            .sub-features {
                grid-template-columns: 1fr; /* 1 coluna de sub-destaques */
            }
            .footer-content { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-main">
            <a href="index.html" class="logo">
                <span class="tv">TV</span>
                <span class="nome">PESQUEIRA</span>
            </a>
            <div class="menu-toggle" onclick="toggleMenu()">&#9776;</div>
            <nav class="nav-menu" id="navMenu">
                <a href="index.html">Início</a>
                <a href="categoria.html?cat=Cidade">Cidade</a>
                <a href="categoria.html?cat=Polícia">Polícia</a>
                <a href="categoria.html?cat=Política">Política</a>
                <a href="categoria.html?cat=Esportes">Esportes</a>
                <a href="categoria.html?cat=Economia">Economia</a>
            </nav>
            <a href="https://www.youtube.com/channel/UCpavRcgQQTc4hv4GSXHFS7A" target="_blank" class="btn-live">
                <i class="fas fa-video"></i> AO VIVO
            </a>
        </div>
    </header>

    <main class="container">
        <section>
            <div class="featured-grid" id="featured-grid">
                <p style="grid-column: 1 / -1; text-align: center;">Carregando Destaques...</p>
                </div>
        </section>

        <section>
            <h2 class="section-title">ÚLTIMAS NOTÍCIAS</h2>
            <div class="recent-news-grid" id="recent-news-grid">
                <p style="grid-column: 1 / -1; text-align: center;">Carregando posts recentes...</p>
                </div>
        </section>

        <div style="margin: 40px auto; max-width: 700px; text-align: center;">
            <div style="background: #e0e0e0; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                <h4 style="font-family: 'Montserrat', sans-serif; font-size: 1.2rem; color: var(--cor-secundaria); margin-bottom: 10px;">ANÚNCIO CENTRAL</h4>
                <p style="font-size: 0.9rem; color: #888;">Espaço Publicitário 700x100</p>
                <img src="https://via.placeholder.com/700x100?text=ANUNCIE+AQUI" alt="Banner Publicitário Central" style="margin-top: 10px; border: 1px solid #ccc; max-width: 100%;">
            </div>
        </div>

    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <div class="logo">
                    <span class="tv">TV</span>
                    <span class="nome">PESQUEIRA</span>
                </div>
                <p style="font-size: 0.9rem; opacity: 0.7;">Levando a verdade dos fatos até você. Jornalismo independente e comprometido com a região.</p>
            </div>
            <div class="footer-col">
                <h4>Editorias</h4>
                <a href="categoria.html?cat=Cidade">Cidade</a>
                <a href="categoria.html?cat=Polícia">Polícia</a>
                <a href="categoria.html?cat=Política">Política</a>
                <a href="categoria.html?cat=Economia">Economia</a>
                <a href="categoria.html?cat=Cultura">Cultura</a>
            </div>
            <div class="footer-col">
                <h4>Institucional</h4>
                <a href="quem-somos.html">Quem Somos</a>
                <a href="anuncie.html">Anuncie</a>
            </div>
            <div class="footer-col">
                <h4>Redes Sociais</h4>
                <a href="https://www.instagram.com/tvpesqueira" target="_blank">Instagram</a>
                <a href="https://www.facebook.com/tvpesqueira" target="_blank">Facebook</a>
                <a href="https://www.youtube.com/@tvpesqueira" target="_blank">Youtube</a>
                <a href="https://twitter.com/tvpesqueira" target="_blank">Twitter/X</a>
            </div>
        </div>
        <div style="text-align: center; margin-top: 30px; font-size: 0.8rem; opacity: 0.5;">
            &copy; 2023 TvPesqueira. Todos os direitos reservados.
        </div>
    </footer>

    <script src="access-control.js"></script>

    <script>
        // Função de formatação de data (Copiada de categoria.html)
        function formatDate(dateString) {
            if (!dateString) return 'Data Desconhecida';
            try {
                const date = new Date(dateString);
                if (isNaN(date)) return 'Data Inválida';
                
                // Formato mais simples para a Home: 5 horas atrás, 2 dias atrás
                const now = Date.now();
                const diff = now - date.getTime();
                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (minutes < 60) return `${minutes} minutos atrás`;
                if (hours < 24) return `${hours} horas atrás`;
                if (days < 7) return `${days} dias atrás`;

                const options = { year: 'numeric', month: 'numeric', day: 'numeric' };
                return date.toLocaleDateString('pt-BR', options);

            } catch (e) {
                return 'Erro na Data';
            }
        }
        
        // Função para responsividade do menu (Copiada de categoria.html)
        function toggleMenu() {
            var menu = document.getElementById("navMenu");
            menu.classList.toggle("active");
        }

        /**
         * Renderiza a seção de Destaques
         * @param {Array} posts - Lista de posts publicados e ordenados.
         */
        function renderFeatured(posts) {
            const mainFeature = posts.find(p => p.destaque === 'main');
            const subFeatures = posts.filter(p => p.destaque === 'sub').slice(0, 2); // Pega os 2 primeiros sub-destaques
            const featuredGrid = document.getElementById('featured-grid');

            let mainFeatureHtml = '';
            let subFeaturesHtml = '';

            if (mainFeature) {
                mainFeatureHtml = `
                    <a href="post.html?id=${mainFeature.id}" class="main-feature">
                        <div class="main-feature-img">
                            <img src="${mainFeature.img || 'https://via.placeholder.com/800x450?text=Destaque+Principal'}" alt="${mainFeature.title}" onerror="this.onerror=null; this.src='https://via.placeholder.com/800x450?text=Destaque+Principal'">
                        </div>
                        <div class="main-feature-content">
                            <div class="main-feature-category">${mainFeature.category}</div>
                            <h2 class="main-feature-title">${mainFeature.title}</h2>
                            <p class="main-feature-excerpt">${mainFeature.description}</p>
                            <p class="main-feature-meta">Por ${mainFeature.author} - ${formatDate(mainFeature.createdAt)}</p>
                        </div>
                    </a>
                `;
            }

            if (subFeatures.length > 0) {
                subFeaturesHtml = subFeatures.map(post => `
                    <a href="post.html?id=${post.id}" class="sub-feature-card">
                        <div class="sub-feature-card-img">
                            <img src="${post.img || 'https://via.placeholder.com/400x225?text=Sub+Destaque'}" alt="${post.title}" onerror="this.onerror=null; this.src='https://via.placeholder.com/400x225?text=Sub+Destaque'">
                        </div>
                        <div class="sub-feature-card-content">
                            <div class="sub-feature-card-category">${post.category}</div>
                            <h3 class="sub-feature-card-title">${post.title}</h3>
                            <p class="sub-feature-card-meta">Por ${post.author} - ${formatDate(post.createdAt)}</p>
                        </div>
                    </a>
                `).join('');

                subFeaturesHtml = `<div class="sub-features">${subFeaturesHtml}</div>`;
            }

            if (mainFeature || subFeatures.length > 0) {
                // Se houver destaque principal E sub-destaques, usa o grid 2x1
                if (mainFeature && subFeatures.length > 0) {
                     featuredGrid.innerHTML = mainFeatureHtml + subFeaturesHtml;
                } else {
                    // Caso contrário (se só houver 1 ou 2), usa o grid de 1 coluna
                    featuredGrid.style.gridTemplateColumns = '1fr';
                    featuredGrid.innerHTML = mainFeatureHtml || subFeaturesHtml;
                }
            } else {
                featuredGrid.style.gridTemplateColumns = '1fr';
                featuredGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 20px;">Não há notícias em destaque no momento.</p>`;
            }
        }

        /**
         * Renderiza a seção de Notícias Recentes (usa o post-card)
         * @param {Array} posts - Lista de posts publicados e ordenados.
         */
        function renderRecentNews(posts) {
            // Remove os posts que já estão nos destaques para evitar repetição (opcional)
            const recentPosts = posts
                .filter(p => p.destaque !== 'main' && p.destaque !== 'sub')
                .slice(0, 9); // Exibe os 9 mais recentes que não são destaque

            const gridElement = document.getElementById('recent-news-grid');
            
            if (recentPosts.length > 0) {
                const postsHtml = recentPosts.map(post => `
                    <a href="post.html?id=${post.id}" class="post-card">
                        <div class="post-card-img">
                            <img src="${post.img || 'https://via.placeholder.com/300x180.png?text=Sem+Imagem'}" alt="${post.title}" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x180.png?text=Sem+Imagem'">
                        </div>
                        <div class="post-card-content">
                            <div class="post-card-category">${post.category}</div>
                            <h3 class="post-card-title">${post.title}</h3>
                            <p class="post-card-excerpt">${post.description}</p>
                            <p class="post-card-meta">Por ${post.author} - ${formatDate(post.createdAt)}</p>
                        </div>
                    </a>
                `).join(''); 
                
                gridElement.innerHTML = postsHtml;

            } else {
                gridElement.innerHTML = `
                    <div style="grid-column: 1 / -1; padding: 20px; text-align: center; background: #fff; border-radius: 8px;">
                        <p style="font-size: 1.1rem; color: #555;">Nenhuma notícia recente disponível no momento.</p>
                    </div>
                `;
            }
        }


        /**
         * Função principal de inicialização da página
         */
        function initializeHomePage() {
            // Garante que loadPosts e savePosts do access-control.js estão carregados
            if (typeof loadPosts !== 'function') {
                console.error("access-control.js não foi carregado corretamente.");
                return;
            }

            // 1. Carrega todos os posts e filtra os publicados
            const allPosts = loadPosts(); 
            const publishedPosts = allPosts
                .filter(p => p.status === 'published')
                // Ordena por data de criação do mais novo para o mais antigo
                .sort((a, b) => b.createdAt - a.createdAt); 

            if (publishedPosts.length === 0) {
                 // Mostra mensagens de "sem posts" nas duas seções
                 document.getElementById('featured-grid').innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; font-size: 1.2rem;">O site está vazio. Por favor, publique algumas notícias no Dashboard.</p>';
                 document.getElementById('recent-news-grid').style.display = 'none';
                 return;
            }

            // 2. Renderiza os Destaques
            renderFeatured(publishedPosts);

            // 3. Renderiza os Posts Recentes
            renderRecentNews(publishedPosts);
        }

        // Executa a função ao carregar a página
        document.addEventListener('DOMContentLoaded', initializeHomePage);
    </script>
</body>
</html>
